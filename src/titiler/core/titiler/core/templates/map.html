<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>TiTiler Map Viewer</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha384-o/2yZuJZWGJ4s/adjxVW71R+EO/LyCwdQfP5UWSgX/w87iiTXuvDZaejd3TsN7mf"
      crossorigin="anonymous"
    />
    <script
      src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha384-okbbMvvx/qfQkmiQKfd5VifbKZ/W8p1qIsWvE1ROPUfHWsDcC8/BnHohF7vPg2T6"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/proj4@2.3.14/dist/proj4.js"
      integrity="sha384-R7x++v2MKcATI+D1/GJsn636xbHca492Sdpm8BD36lj5vdWB9+OUBpM1oKkrzqv9"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://unpkg.com/proj4leaflet@1.0.2/src/proj4leaflet.js"
      integrity="sha384-aDnBHDK9AhLbrYhThBxEVMriFbix8Sz2059IlD3HbZhz7+WNmz+pSkOcI7MY72cE"
      crossorigin="anonymous"
    ></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background-color: #e5e5e5;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
      .fixed-bottom {
          position: absolute;
          left: 0;
          bottom: 0;
          z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div class="fixed-bottom">
      <div style="padding: 10px;"">
        </br>
        <a href="https://www.developmentseed.org/" target="_blank">
          <img width=200 src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+Cjxzdmcgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDE4OCAzMiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxuczpzZXJpZj0iaHR0cDovL3d3dy5zZXJpZi5jb20vIiBzdHlsZT0iZmlsbC1ydWxlOmV2ZW5vZGQ7Y2xpcC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjI7Ij4KICAgIDxyZWN0IGlkPSJob3ItLXBvcyIgeD0iMCIgeT0iMCIgd2lkdGg9IjE4OCIgaGVpZ2h0PSIzMiIgc3R5bGU9ImZpbGw6bm9uZTsiLz4KICAgIDxnIGlkPSJob3ItLXBvczEiIHNlcmlmOmlkPSJob3ItLXBvcyI+CiAgICAgICAgPGcgaWQ9InRleHQiPgogICAgICAgICAgICA8cGF0aCBkPSJNNDksNkw0OSwxMC45QzQ5LDEwLjggNDguMiwxMC44IDQ3LjksMTAuN0M0Ny42LDEwLjcgNDcuMywxMC42IDQ2LjgsMTAuNkM0NiwxMC42IDQ1LjIsMTAuNyA0NC42LDExQzQ0LDExLjMgNDMuNSwxMS43IDQzLjEsMTIuMkM0Mi43LDEyLjcgNDIuNCwxMy40IDQyLjIsMTQuMkM0Mi4xLDE1IDQyLDE1LjkgNDIsMTYuOEM0MiwxOC43IDQyLjMsMjAuMiA0MywyMS4yQzQzLjcsMjIuMiA0NC43LDIyLjcgNDUuOSwyMi43QzQ2LjcsMjIuNyA0Ny4zLDIyLjYgNDcuOCwyMi4zQzQ4LjMsMjIgNDguNywyMS44IDQ5LjEsMjEuMUw0OS4yLDIyLjlMNTEsMjIuOUw1MSw2TDQ5LDZaTTQ5LDE3LjVDNDksMTggNDguOSwxOC41IDQ4LjgsMTlDNDguNywxOS41IDQ4LjUsMTkuOSA0OC4yLDIwLjJDNDgsMjAuNSA0Ny43LDIwLjggNDcuMywyMUM0NywyMS4yIDQ2LjYsMjEuMyA0Ni4yLDIxLjNDNDUuNCwyMS4zIDQ0LjgsMjAuOSA0NC40LDIwLjFDNDQsMTkuMyA0My44LDE4LjIgNDMuOCwxNi42QzQzLjgsMTUuMSA0NCwxNCA0NC41LDEzLjJDNDQuOSwxMi40IDQ1LjcsMTIuMSA0Ni43LDEyLjFDNDcuMiwxMi4xIDQ3LjYsMTIuMSA0OCwxMi4yQzQ4LjQsMTIuMyA0OSwxMi40IDQ5LDEyLjVMNDksMTcuNVpNNTguOCwyMi4zQzU4LjEsMjIuNiA1Ny4zLDIyLjggNTYuNSwyMi44QzU1LDIyLjggNTMuOSwyMi40IDUzLjIsMjEuNUM1Mi41LDIwLjYgNTIuMSwxOS4yIDUyLjEsMTcuM0M1Mi4xLDE1LjEgNTIuNSwxMy40IDUzLjMsMTIuM0M1NC4xLDExLjIgNTUuMiwxMC42IDU2LjYsMTAuNkM1OCwxMC42IDU5LDExLjEgNTkuOCwxMi4xQzYwLjUsMTMuMSA2MC44LDE0LjcgNjAuNywxNi44TDU0LDE2LjhMNTQsMTdDNTQsMTguNiA1NC4yLDE5LjcgNTQuNywyMC40QzU1LjIsMjEuMSA1NS44LDIxLjQgNTYuNywyMS40QzU3LjIsMjEuNCA1Ny44LDIxLjMgNTguMywyMS4xQzU4LjgsMjAuOSA1OS40LDIwLjYgNjAuMSwyMC4xTDYwLjgsMjEuM0M2MC4xLDIxLjcgNTkuNSwyMiA1OC44LDIyLjNaTTU4LjIsMTIuOUM1Ny44LDEyLjMgNTcuMiwxMiA1Ni41LDEyQzU1LjgsMTIgNTUuMiwxMi4zIDU0LjgsMTIuOUM1NC40LDEzLjUgNTQuMiwxNC40IDU0LjEsMTUuNUw1OC44LDE1LjVDNTguOCwxNC40IDU4LjYsMTMuNSA1OC4yLDEyLjlaTTY5LjIsMTMuNkM2OSwxNC41IDY4LjcsMTUuNCA2OC40LDE2LjRDNjguMSwxNy4zIDY3LjgsMTguMyA2Ny41LDE5LjRDNjcuMiwyMC40IDY2LjksMjEuNSA2Ni41LDIyLjZMNjQuNywyMi42QzY0LjMsMjEuNCA2NCwyMC4zIDYzLjYsMTkuM0w2Mi43LDE2LjNDNjIuNCwxNS40IDYyLjIsMTQuNCA2MS45LDEzLjZDNjEuNywxMi43IDYxLjUsMTEuOCA2MS4zLDExTDYzLDExTDY0LjIsMTUuOEM2NC42LDE3LjQgNjUuMSwxOSA2NS42LDIwLjdMNjYuOSwxNS45QzY3LjMsMTQuMyA2Ny43LDEyLjcgNjguMSwxMUw2OS43LDExQzY5LjcsMTEuOCA2OS41LDEyLjcgNjkuMiwxMy42Wk03Ny4xLDIyLjNDNzYuNCwyMi42IDc1LjYsMjIuOCA3NC44LDIyLjhDNzMuMywyMi44IDcyLjIsMjIuNCA3MS41LDIxLjVDNzAuOCwyMC42IDcwLjQsMTkuMiA3MC40LDE3LjNDNzAuNCwxNS4xIDcwLjgsMTMuNCA3MS42LDEyLjNDNzIuNCwxMS4yIDczLjUsMTAuNiA3NC45LDEwLjZDNzYuMywxMC42IDc3LjMsMTEuMSA3OC4xLDEyLjFDNzguOCwxMy4xIDc5LjEsMTQuNyA3OSwxNi44TDcyLjMsMTYuOEw3Mi4zLDE3QzcyLjMsMTguNiA3Mi41LDE5LjcgNzMsMjAuNEM3My41LDIxLjEgNzQuMSwyMS40IDc1LDIxLjRDNzUuNSwyMS40IDc2LjEsMjEuMyA3Ni42LDIxLjFDNzcuMSwyMC45IDc3LjcsMjAuNiA3OC40LDIwLjFMNzkuMSwyMS4zQzc4LjQsMjEuNyA3Ny44LDIyIDc3LjEsMjIuM1pNNzYuNSwxMi45Qzc2LjEsMTIuMyA3NS41LDEyIDc0LjgsMTJDNzQuMSwxMiA3My41LDEyLjMgNzMuMSwxMi45QzcyLjcsMTMuNSA3Mi41LDE0LjQgNzIuNCwxNS41TDc3LDE1LjVDNzcuMSwxNC40IDc2LjksMTMuNSA3Ni41LDEyLjlaTTgwLjUsMjIuNkw4MC41LDYuNUw4Mi4yLDYuNUw4Mi4yLDIyLjZMODAuNSwyMi42Wk04OC4xLDIyLjhDODYuNiwyMi44IDg1LjUsMjIuMyA4NC44LDIxLjRDODQuMSwyMC40IDgzLjcsMTguOSA4My43LDE2LjlDODMuNywxNC44IDg0LjEsMTMuMyA4NC44LDEyLjJDODUuNSwxMS4yIDg2LjcsMTAuNyA4OC4zLDEwLjdDODkuOCwxMC43IDkwLjksMTEuMiA5MS42LDEyLjJDOTIuMywxMy4yIDkyLjYsMTQuNyA5Mi42LDE2LjdDOTIuNiwyMC44IDkxLjEsMjIuOCA4OC4xLDIyLjhaTTkwLjIsMTMuMkM4OS44LDEyLjQgODkuMSwxMiA4OC4xLDEyQzg3LjIsMTIgODYuNiwxMi40IDg2LjIsMTMuMUM4NS44LDEzLjkgODUuNiwxNSA4NS42LDE2LjZDODUuNiwxOC4zIDg1LjgsMTkuNSA4Ni4yLDIwLjJDODYuNiwyMC45IDg3LjMsMjEuMyA4OC4yLDIxLjNDODkuOCwyMS4zIDkwLjcsMTkuOCA5MC43LDE2LjdDOTAuNywxNS4xIDkwLjUsMTMuOSA5MC4yLDEzLjJaTTEwMi40LDIxLjFDMTAxLjYsMjIuMiAxMDAuNCwyMi44IDk4LjcsMjIuOEM5OC4zLDIyLjggOTcuOSwyMi44IDk3LjYsMjIuN0M5Ny4zLDIyLjcgOTcsMjIuNiA5Ni41LDIyLjVMOTYuNSwyNi40TDk0LjgsMjYuNEw5NC44LDEwLjlMOTYuMywxMC45TDk2LjQsMTIuNEM5Ni44LDExLjcgOTcuMiwxMS4zIDk3LjcsMTFDOTguMiwxMC43IDk4LjgsMTAuNiA5OS42LDEwLjZDMTAwLjksMTAuNiAxMDEuOCwxMS4xIDEwMi41LDEyLjFDMTAzLjIsMTMuMSAxMDMuNSwxNC42IDEwMy41LDE2LjVDMTAzLjUsMTguNSAxMDMuMiwyMCAxMDIuNCwyMS4xWk0xMDEuMSwxMy4zQzEwMC43LDEyLjUgMTAwLjEsMTIuMSA5OS4zLDEyLjFDOTguOSwxMi4xIDk4LjUsMTIuMiA5OC4yLDEyLjRDOTcuOSwxMi42IDk3LjYsMTIuOSA5Ny40LDEzLjJDOTcuMiwxMy41IDk3LDEzLjkgOTYuOCwxNC40Qzk2LjYsMTQuOSA5Ni42LDE1LjMgOTYuNiwxNS45TDk2LjYsMjFDOTYuOSwyMS4xIDk3LjIsMjEuMiA5Ny42LDIxLjNDOTgsMjEuNCA5OC40LDIxLjQgOTguOSwyMS40Qzk5LjksMjEuNCAxMDAuNiwyMSAxMDEuMSwyMC4zQzEwMS42LDE5LjYgMTAxLjgsMTguNCAxMDEuOCwxNi45QzEwMS43LDE1LjIgMTAxLjUsMTQgMTAxLjEsMTMuM1pNMTE3LjYsMjIuNkwxMTcuNiwxNC43QzExNy42LDEzLjkgMTE3LjUsMTMuMiAxMTcuNCwxMi43QzExNy4zLDEyLjIgMTE2LjksMTIgMTE2LjMsMTJDMTE1LjksMTIgMTE1LjUsMTIuMSAxMTUuMSwxMi40QzExNC43LDEyLjcgMTE0LjIsMTMuMSAxMTMuNSwxMy42TDExMy41LDIyLjVMMTExLjgsMjIuNUwxMTEuOCwxNC43QzExMS44LDEzLjkgMTExLjcsMTMuMiAxMTEuNiwxMi43QzExMS41LDEyLjIgMTExLjEsMTIgMTEwLjUsMTJDMTEwLjEsMTIgMTA5LjcsMTIuMSAxMDkuMywxMi40QzEwOC45LDEyLjcgMTA4LjQsMTMuMSAxMDcuNywxMy42TDEwNy43LDIyLjVMMTA2LDIyLjVMMTA2LDEwLjlMMTA3LjUsMTAuOUwxMDcuNiwxMi4zTDEwOS4zLDExLjFDMTA5LjgsMTAuOCAxMTAuNCwxMC42IDExMSwxMC42QzExMS43LDEwLjYgMTEyLjIsMTAuOCAxMTIuNSwxMS4xQzExMi44LDExLjQgMTEzLjEsMTEuOCAxMTMuMywxMi40QzExMy45LDExLjkgMTE0LjUsMTEuNSAxMTUuMSwxMS4yQzExNS43LDEwLjkgMTE2LjIsMTAuNyAxMTYuOCwxMC43QzExNy44LDEwLjcgMTE4LjQsMTEgMTE4LjgsMTEuNkMxMTkuMiwxMi4yIDExOS4zLDEzLjEgMTE5LjMsMTQuNEwxMTkuMywyMi42TDExNy42LDIyLjZaTTEyNy41LDIyLjNDMTI2LjgsMjIuNiAxMjYsMjIuOCAxMjUuMiwyMi44QzEyMy43LDIyLjggMTIyLjYsMjIuNCAxMjEuOSwyMS41QzEyMS4yLDIwLjYgMTIwLjgsMTkuMiAxMjAuOCwxNy4zQzEyMC44LDE1LjEgMTIxLjIsMTMuNCAxMjIsMTIuM0MxMjIuOCwxMS4yIDEyMy45LDEwLjYgMTI1LjMsMTAuNkMxMjYuNywxMC42IDEyNy43LDExLjEgMTI4LjUsMTIuMUMxMjkuMiwxMy4xIDEyOS41LDE0LjcgMTI5LjQsMTYuOEwxMjIuNywxNi44TDEyMi43LDE3QzEyMi43LDE4LjYgMTIyLjksMTkuNyAxMjMuNCwyMC40QzEyMy45LDIxLjEgMTI0LjUsMjEuNCAxMjUuNCwyMS40QzEyNS45LDIxLjQgMTI2LjUsMjEuMyAxMjcsMjEuMUMxMjcuNSwyMC45IDEyOC4xLDIwLjYgMTI4LjgsMjAuMUwxMjkuNSwyMS4zQzEyOC44LDIxLjcgMTI4LjEsMjIgMTI3LjUsMjIuM1pNMTI2LjgsMTIuOUMxMjYuNCwxMi4zIDEyNS44LDEyIDEyNS4xLDEyQzEyNC40LDEyIDEyMy44LDEyLjMgMTIzLjQsMTIuOUMxMjMsMTMuNSAxMjIuOCwxNC40IDEyMi43LDE1LjVMMTI3LjQsMTUuNUMxMjcuNCwxNC40IDEyNy4yLDEzLjUgMTI2LjgsMTIuOVpNMTM2LjksMjIuNUwxMzYuOSwxNC43QzEzNi45LDEzLjkgMTM2LjgsMTMuMiAxMzYuNiwxMi43QzEzNi40LDEyLjIgMTM2LDEyIDEzNS40LDEyQzEzNSwxMiAxMzQuNiwxMi4xIDEzNC4yLDEyLjRDMTMzLjgsMTIuNyAxMzMuMiwxMy4xIDEzMi42LDEzLjZMMTMyLjYsMjIuNUwxMzAuOSwyMi41TDEzMC45LDEwLjlMMTMyLjQsMTAuOUwxMzIuNSwxMi4zQzEzMy4xLDExLjkgMTMzLjcsMTEuNSAxMzQuMiwxMS4xQzEzNC44LDEwLjggMTM1LjMsMTAuNiAxMzUuOSwxMC42QzEzNi45LDEwLjYgMTM3LjYsMTAuOSAxMzcuOSwxMS41QzEzOC4zLDEyLjEgMTM4LjUsMTMgMTM4LjUsMTQuM0wxMzguNSwyMi41TDEzNi45LDIyLjVaTTE0NC43LDIyLjhDMTQ0LjEsMjIuOCAxNDMuNSwyMi43IDE0My4xLDIyLjZDMTQyLjcsMjIuNSAxNDIuNCwyMi4yIDE0Mi4yLDIxLjlDMTQyLDIxLjYgMTQxLjgsMjEuMiAxNDEuOCwyMC42QzE0MS43LDIwLjEgMTQxLjcsMTkuNCAxNDEuNywxOC43TDE0MS43LDEyLjNMMTQwLDEyLjNMMTQwLDEwLjlMMTQxLjcsMTAuOUwxNDEuNyw3LjdMMTQzLjQsNy41TDE0My40LDEwLjlMMTQ1LjgsMTAuOUwxNDUuNywxMi4zTDE0My41LDEyLjNMMTQzLjUsMTkuOEMxNDMuNSwyMC4yIDE0My42LDIwLjUgMTQzLjcsMjAuN0MxNDMuOCwyMC45IDE0NCwyMS4xIDE0NC4yLDIxLjJDMTQ0LjQsMjEuMyAxNDQuNywyMS40IDE0NS4xLDIxLjRMMTQ1LjYsMjEuNEwxNDYuMSwyMS4zTDE0Ni4zLDIyLjdDMTQ1LjcsMjIuNyAxNDUuMiwyMi44IDE0NC43LDIyLjhaIiBzdHlsZT0iZmlsbDpyZ2IoNjgsNjMsNjMpO2ZpbGwtcnVsZTpub256ZXJvOyIvPgogICAgICAgICAgICA8cGF0aCBkPSJNMTU3LjQsMjAuNEMxNTcuMiwyMC45IDE1Ni45LDIxLjMgMTU2LjUsMjEuNkMxNTYuMSwyMS45IDE1NS42LDIyLjIgMTU1LjEsMjIuNEMxNTQuNSwyMi42IDE1My45LDIyLjcgMTUzLjMsMjIuN0MxNTEuOCwyMi43IDE1MC44LDIyLjQgMTUwLjEsMjEuOEMxNDkuNCwyMS4yIDE0OS4yLDIwLjMgMTQ5LjMsMTkuM0wxNTAuOCwxOS4xQzE1MC44LDE5LjQgMTUwLjgsMTkuNiAxNTAuOSwxOS45QzE1MSwyMC4yIDE1MS4xLDIwLjQgMTUxLjMsMjAuNkMxNTEuNSwyMC44IDE1MS44LDIxIDE1Mi4xLDIxLjFDMTUyLjUsMjEuMiAxNTIuOSwyMS4zIDE1My41LDIxLjNDMTU0LjMsMjEuMyAxNTQuOSwyMS4xIDE1NS40LDIwLjdDMTU1LjksMjAuMyAxNTYuMSwxOS43IDE1Ni4xLDE5QzE1Ni4xLDE4LjQgMTU1LjksMTcuOSAxNTUuNiwxNy42QzE1NS4zLDE3LjIgMTU0LjksMTcgMTU0LjQsMTYuN0MxNTMuOSwxNi41IDE1My40LDE2LjIgMTUyLjgsMTZDMTUyLjIsMTUuOCAxNTEuNywxNS41IDE1MS4yLDE1LjJDMTUwLjcsMTQuOSAxNTAuMywxNC41IDE1MCwxNEMxNDkuNywxMy41IDE0OS41LDEyLjkgMTQ5LjUsMTIuMUMxNDkuNSwxMS42IDE0OS42LDExLjEgMTQ5LjgsMTAuNkMxNTAsMTAuMiAxNTAuMyw5LjggMTUwLjYsOS41QzE1MSw5LjIgMTUxLjQsOSAxNTEuOSw4LjhDMTUyLjQsOC42IDE1Myw4LjYgMTUzLjcsOC42QzE1NC40LDguNiAxNTUsOC43IDE1NS40LDguOUMxNTUuOSw5LjEgMTU2LjMsOS4zIDE1Ni42LDkuNkMxNTYuOSw5LjkgMTU3LjEsMTAuMiAxNTcuMiwxMC42QzE1Ny4zLDExIDE1Ny40LDExLjQgMTU3LjQsMTEuOEwxNTUuOSwxMkMxNTUuOSwxMS43IDE1NS45LDExLjUgMTU1LjgsMTEuMkMxNTUuNywxMSAxNTUuNiwxMC43IDE1NS40LDEwLjZDMTU1LjIsMTAuNCAxNTUsMTAuMyAxNTQuNywxMC4yQzE1NC40LDEwLjEgMTU0LDEwIDE1My42LDEwQzE1My4yLDEwIDE1Mi44LDEwLjEgMTUyLjUsMTAuMkMxNTIuMiwxMC4zIDE1MS45LDEwLjUgMTUxLjcsMTAuNkMxNTEuNSwxMC44IDE1MS4zLDExIDE1MS4yLDExLjJDMTUxLjEsMTEuNCAxNTEsMTEuNyAxNTEsMTJDMTUxLDEyLjYgMTUxLjIsMTMuMSAxNTEuNSwxMy40QzE1MS44LDEzLjggMTUyLjMsMTQgMTUyLjgsMTQuM0wxNTQuNCwxNUMxNTUsMTUuMiAxNTUuNSwxNS41IDE1NiwxNS44QzE1Ni41LDE2LjEgMTU2LjksMTYuNSAxNTcuMywxN0MxNTcuNiwxNy41IDE1Ny44LDE4LjEgMTU3LjgsMTguOUMxNTcuNywxOS40IDE1Ny42LDE5LjkgMTU3LjQsMjAuNFpNMTU5LjcsMjIuNkwxNTkuNyw4LjlMMTY2LjYsOC45TDE2Ni41LDEwLjNMMTYxLjQsMTAuM0wxNjEuNCwxNC44TDE2NS40LDE0LjhMMTY1LjQsMTYuMkwxNjEuNCwxNi4yTDE2MS40LDIxLjJMMTY2LjcsMjEuMkwxNjYuNywyMi42TDE1OS43LDIyLjZaTTE2OC44LDIyLjZMMTY4LjgsOC45TDE3NS43LDguOUwxNzUuNiwxMC4zTDE3MC41LDEwLjNMMTcwLjUsMTQuOEwxNzQuNSwxNC44TDE3NC41LDE2LjJMMTcwLjUsMTYuMkwxNzAuNSwyMS4yTDE3NS44LDIxLjJMMTc1LjgsMjIuNkwxNjguOCwyMi42Wk0xODYuOCwxOC40QzE4Ni41LDE5LjMgMTg2LjEsMjAgMTg1LjYsMjAuNkMxODUuMSwyMS4yIDE4NC40LDIxLjcgMTgzLjcsMjJDMTgyLjksMjIuMyAxODIuMSwyMi41IDE4MS4xLDIyLjVMMTc4LjIsMjIuNUwxNzguMiw4LjlMMTgxLjEsOC45QzE4My4xLDguOSAxODQuNyw5LjUgMTg1LjcsMTAuN0MxODYuNywxMS45IDE4Ny4yLDEzLjUgMTg3LjIsMTUuNkMxODcuMiwxNi42IDE4Ny4xLDE3LjUgMTg2LjgsMTguNFpNMTg0LjQsMTEuN0MxODMuNywxMC43IDE4Mi42LDEwLjIgMTgxLDEwLjJMMTc5LjksMTAuMkwxNzkuOSwyMS4xTDE4MS4zLDIxLjFDMTgyLjcsMjEuMSAxODMuNywyMC42IDE4NC40LDE5LjdDMTg1LjEsMTguOCAxODUuNSwxNy40IDE4NS41LDE1LjdDMTg1LjQsMTQgMTg1LjEsMTIuNyAxODQuNCwxMS43WiIgc3R5bGU9ImZpbGw6cmdiKDIwOCw2NiwwKTtmaWxsLXJ1bGU6bm9uemVybzsiLz4KICAgICAgICA8L2c+CiAgICAgICAgPGcgaWQ9InN5bWJvbCI+CiAgICAgICAgICAgIDxwYXRoIGlkPSJzdXJmYWNlIiBkPSJNMzAsMEwyLDBDMC45LDAgMCwwLjkgMCwyTDAsMzBDMCwzMS4xIDAuOSwzMiAyLDMyTDMwLDMyQzMxLjEsMzIgMzIsMzEuMSAzMiwzMEwzMiwyQzMyLDAuOSAzMS4xLDAgMzAsMFoiIHN0eWxlPSJmaWxsOnJnYigyMDgsNjYsMCk7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDxnIGlkPSJzaGFwZSIgdHJhbnNmb3JtPSJtYXRyaXgoMC45MjUzNDIsMCwwLDAuOTI1MzQyLDEuMTk0NTMsMi4zODkwNikiPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTE4LjEsMjcuMkMxOC4xLDI2LjYgMTguMywyNiAxOC41LDI1LjRDMTcuOSwyNS45IDE3LjcsMjYuNSAxNy41LDI3LjNDMTcuNiwyNi40IDE4LDIwLjQgMTgsMjAuMUMxOS41LDE1LjcgMTguOCwyLjcgMjAuOCwxQzE4LjYsMS40IDE3LjgsMy43IDE3LjEsNS41QzE2LjQsMy40IDE3LDIgMTQuNiwxLjJDMTYuNSwyLjggMTYuMSw0LjIgMTYuNSw2LjRDMTUuNCw0LjkgMTUuNywzLjEgMTQuNCwxLjZDMTQsMS4yIDEyLjgsMC4zIDEyLjgsMC4zQzEyLjgsMC40IDEzLjgsMi4zIDE0LDMuNEMxNC4yLDQuNCAxNC42LDYuNSAxNC42LDcuM0MxNC44LDExLjUgMTUuOCwxNS42IDE2LjYsMTkuOEMxNi43LDIwLjUgMTcuMSwyMi42IDE3LjEsMjIuNkwxNy4yLDIzLjVDMTcuMSwyMi45IDE2LjksMjIuNCAxNi45LDIyLjJDMTYuNywyMS42IDE2LjIsMjAgMTYsMTkuM0MxNC4yLDE1LjYgMTEsOC41IDYuNiw3LjRDOS4xLDkuNiAxMS43LDEyLjUgMTIuMywxNS4zQzExLDEzLjQgNS44LDkuNSAzLjYsOEM3LjYsMTIuMSAxMC44LDE2LjQgMTQuMywyMUMxNS4zLDIyLjMgMTYuNiwyNSAxNi43LDI1LjZDMTYuOCwyNiAxNi44LDI3LjcgMTYuOSwyOC43QzE1LDI0IDEzLjksMjEuNiAxMC4zLDE5LjVDOS43LDE5LjIgNy44LDE4LjUgNy44LDE4LjVDOC43LDE5LjUgOS43LDE5LjUgMTAuNSwyMC44QzguOSwxOS43IDcuMiwxOS41IDUuMywxOS41QzExLjMsMjIuNiAxNC41LDIzLjUgMTYuNSwyOS40QzE2LjcsMzAuNCAxNi40LDMxIDE2LjQsMzJMMTcuNywzMkwxNy43LDMwLjZDMTcuOCwzMC4yIDE3LjgsMjguOSAxOCwyOC42QzE4LjYsMjcgMTkuNiwyNi4zIDIxLjEsMjUuM0MxOS43LDI1LjggMTkuMSwyNS42IDE4LjEsMjcuMlpNMjQsMTMuMkMyMy41LDEzLjcgMjIsMTUuNSAyMiwxNS41QzIyLjEsMTIuOSAyMi43LDEwLjEgMjQuNCw4LjFDMjIuMSw5LjYgMjAuOCwxMy40IDIwLjEsMTUuN0MxOS45LDE2LjYgMTcuMSwyMiAxOC40LDI0LjlDMTguNiwyMy44IDE5LjIsMjIuOCAxOS45LDIxLjlDMjAuMiwyMS41IDIxLjUsMTkuNCAyMi44LDE2LjVDMjMuOSwxMy42IDI1LjgsMTEuOCAyOC40LDEwLjRDMjYuNSwxMC43IDI1LjQsMTEuOCAyNCwxMy4yWiIgc3R5bGU9ImZpbGw6d2hpdGU7ZmlsbC1ydWxlOm5vbnplcm87Ii8+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPgo="
            alt="Development Seed">
        </a>
      </div>
    </div>
    <script type="text/javascript">

      const bboxPolygon = (bounds) => {
          var LL_EPSILON = 1e-6
          return {
              'type': 'Feature',
              'geometry': {
                  'type': 'Polygon',
                  'coordinates': [[
                      [bounds[0] + LL_EPSILON, bounds[1] + LL_EPSILON],
                      [bounds[2] -  LL_EPSILON, bounds[1] + LL_EPSILON],
                      [bounds[2] - LL_EPSILON, bounds[3] - LL_EPSILON],
                      [bounds[0] + LL_EPSILON, bounds[3] - LL_EPSILON],
                      [bounds[0] + LL_EPSILON, bounds[1] + LL_EPSILON]
                  ]]
              },
              'properties': {}
          }
      }

      var crs = new L.Proj.CRS(
          '{{ tms.crs.srs }}',
          '{{ tms.crs.to_proj4() }}', {
          origin: [{{ tms.xy_bbox.left }}, {{ tms.xy_bbox.top }}],
          bounds: L.bounds(
            L.Point({{ tms.xy_bbox.left}}, {{ tms.xy_bbox.bottom }}),
            L.Point({{ tms.xy_bbox.right}}, {{ tms.xy_bbox.top }})
          ),
          resolutions: {{ resolutions|safe }},
        }
      );


      var map = L.map('map', {
        crs: crs,
        minZoom: {{ tms.minzoom }},
        maxZoom: {{ tms.maxzoom }},
        attributionControl: false
      });

      L.control.attribution({prefix: '<a href="https://leafletjs.com" target="_blank">Leaflet</a> | <a href="https://developmentseed.org/titiler" target="_blank">Titiler</a>'}).addTo(map)

      let baseLayers = {};
      let overlayLayers = {};
      let activeBaseLayer = null;

      if ("{{ tms.id }}" === "WebMercatorQuad") {

        const esriSatelliteLayer = L.tileLayer(
          'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; ESRI &mdash; Source: Esri, DigitalGlobe, GeoEye, i-cubed, USDA FSA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community',
            maxZoom: 19
          }
        );
        esriSatelliteLayer.addTo(map);
        baseLayers["Esri Satellite"] = esriSatelliteLayer;

        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        });
        osmLayer.addTo(map);
        baseLayers["OpenStreetMap"] = osmLayer;
        activeBaseLayer = osmLayer;
      }

      // Add some placemarks for use in validating display with custom TMS
      var nullIsland = L.marker([0, 0]),
        madrid = L.marker([40, -3]),
        london = L.marker([51.50722, -0.1275]),
        auckland = L.marker([-36.864664, 174.792059]),
        seattle = L.marker([47.596842, -122.333087]);

      var cities = L.layerGroup([nullIsland, london, auckland, seattle]);

      document.addEventListener('keydown', function(e) {
        if (e.key === 'b' || e.key === 'B') {
          if (map.hasLayer(cities)) {
            map.removeLayer(cities);
          } else {
            map.addLayer(cities);
          }
        }
      });

      const toggleButton = L.control({position: 'bottomright'});
      toggleButton.onAdd = function(map) {
          const div = L.DomUtil.create('div', 'toggle-cities');
          div.innerHTML = `
              <button style="
                  font-size: 10px;
                  padding: 2px 5px;
                  background: rgba(255, 255, 255, 0.8);
                  border: 1px solid #ccc;
                  border-radius: 3px;
                  cursor: pointer;
              ">âš²</button>
          `;
          div.onclick = function() {
              if (map.hasLayer(cities)) {
                  map.removeLayer(cities);
              } else {
                  map.addLayer(cities);
              }
          };
          return div;
      };
      toggleButton.addTo(map);

      // Add the tile layer!
      fetch('{{ tilejson_endpoint|safe }}')
        .then(res => {
          if (res.ok) return res.json()
          throw new Error('Network response was not ok.')
        })
        .then(data => {
          console.log(data);

          let bounds = [...data.bounds];

          var left = bounds[0],
            bottom = bounds[1],
            right = bounds[2],
            top = bounds[3];

          if (left < right) {
            left = Math.max(left, {{ tms.bbox.left }});
            right = Math.min(right, {{ tms.bbox.right }});
          }
          bottom = Math.max(bottom, {{ tms.bbox.bottom }});
          top = Math.min(top, {{ tms.bbox.top }});

          let geo;
          if (left > right) {
            geo = {
              "type": "FeatureCollection",
              "features": [
                bboxPolygon([-180, bottom, right, top]),
                bboxPolygon([left, bottom, 180, top]),
              ]
            };
          } else {
            geo = {
              "type": "FeatureCollection",
              "features": [bboxPolygon([left, bottom, right, top])]
            };
          }

          var aoi = L.geoJSON(geo, {
              color: '#3bb2d0', fill: false
          }).addTo(map);
          map.fitBounds(aoi.getBounds());

          if (left > right) {
            left = right - 360;
          }

          const tileLayer = L.tileLayer(
            data.tiles[0], {
              maxNativeZoom: data.maxzoom,
              minZoom: data.minzoom,
              bounds: L.latLngBounds([bottom, left], [top, right]),
              attribution: data.attribution,
            }
          );

          overlayLayers["TiTiler Layer"] = tileLayer;

          tileLayer.addTo(map);

          // Add L.control.layers with base and overlay layers
          L.control.layers(baseLayers, overlayLayers, {collapsed: false}).addTo(map);
        })
        .catch(err => {
          console.warn(err);
        });

      // run point query on right-click
      map.on('contextmenu', function(e) {
        const lat = e.latlng.lat.toFixed(3);
        const lng = e.latlng.lng.toFixed(3);

        const popup = L.popup()
          .setLatLng(e.latlng)
          .setContent("<p>Loading point data...</p>")
          .openOn(map);

        fetch(`{{ point_endpoint|safe }}`.replace('{lat}', lat).replace('{lon}', lng))
          .then(res => {
            if (res.ok) return res.json();

            return res.json().then(errorData => {
              const error = new Error(errorData.detail || `Server error: ${res.status}`);
              error.status = res.status;
              error.errorData = errorData;
              throw error;
            })
          })
          .then(data => {
            const formatPopupContent = (data) => {
              let html = '<div style="max-width: 250px;">';

              html += `<p><strong>Coordinates:</strong> ${lat}, ${lng}</p>`;

              // single band case - just show the value
              if (data.band_names.length === 1) {
                const value = data.values[0] !== null ? data.values[0] : 'No data';
                html += `<p><strong>Value:</strong> ${value}</p>`;
              }
              // multiple bands case - show in a table
              else {
                html += '<table style="width: 100%; border-collapse: collapse;">';
                html += '<tr><th style="text-align: left; padding: 1px; border-bottom: 1px solid #ddd;">Band</th>' +
                        '<th style="text-align: right; padding: 1px; border-bottom: 1px solid #ddd;">Value</th></tr>';

                for (let i = 0; i < data.band_names.length; i++) {
                  const value = data.values[i] !== null ? data.values[i] : 'No data';
                  html += `<tr>
                    <td style="text-align: left; padding: 1px;">${data.band_names[i]}</td>
                    <td style="text-align: right; padding: 1px;">${value}</td>
                  </tr>`;
                }

                html += '</table>';
              }

              html += '</div>';
              return html;
            };

          popup.setContent(formatPopupContent(data));
        })
        .catch(err => {
          if (err.errorData && err.errorData.detail) {
            popup.setContent(`<p>${err.errorData.detail}</p>`);
          } else {
            popup.setContent(`<p>Error: ${err.message || 'An unknown error occurred'}</p>`);
          }
        });
      });
    </script>
  </body>
</html>
